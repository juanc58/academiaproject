{% extends "base.html" %}
{% block content %}
<main class="px-8 py-8">
  <div class="container mx-auto max-w-7xl">
    <div class="bg-white shadow rounded-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold">Reportes por Usuarios</h2>

        <svg class="size-9 -ml-28" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M149.6 123.2c0 49.6 40 89.6 89.6 89.6h590.4c-6.4-11.2-12.8-25.6-17.6-43.2H492v-32h315.2c0-11.2 0-20.8 1.6-32H372v-32h444.8c3.2-12.8 9.6-27.2 16-41.6H239.2c-49.6 0-89.6 41.6-89.6 91.2z" fill="#FFFFFF"></path><path d="M239.2 244.8c-8 0-17.6-1.6-25.6-3.2-25.6-4.8-48-19.2-64-36.8v657.6c0 48 11.2 83.2 35.2 105.6 27.2 25.6 64 24 64 24h624V244.8H239.2z" fill="#FFFFFF"></path><path d="M906.4 32V0H239.2C172 0 117.6 54.4 117.6 121.6v740.8c0 57.6 16 100.8 46.4 129.6 32 30.4 70.4 32 83.2 32H906.4V212.8h-36.8c-8-8-62.4-68.8 0-180.8h36.8z m-89.6 41.6H372v32h436.8c-1.6 11.2-1.6 20.8-1.6 32H492v32h320c4.8 17.6 11.2 32 17.6 43.2H239.2c-49.6 0-89.6-40-89.6-89.6S189.6 32 239.2 32h593.6c-6.4 14.4-12.8 28.8-16 41.6z m56 918.4h-624s-36.8 1.6-64-24c-24-22.4-35.2-57.6-35.2-105.6V204.8c16 17.6 38.4 32 64 36.8 8 1.6 17.6 3.2 25.6 3.2h633.6V992z" fill=""></path><path d="M808.8 928V244.8H239.2c-9.6 0-17.6-1.6-25.6-3.2V928h595.2z" fill="#fff585"></path><path d="M450.4 488a68.8 68.8 0 1 0 137.6 0 68.8 68.8 0 1 0-137.6 0Z" fill="#FFFFFF"></path><path d="M519.2 387.2c-56 0-100.8 44.8-100.8 100.8s44.8 100.8 100.8 100.8S620 544 620 488s-44.8-100.8-100.8-100.8z m0 169.6c-38.4 0-68.8-30.4-68.8-68.8s30.4-68.8 68.8-68.8S588 449.6 588 488s-30.4 68.8-68.8 68.8z" fill=""></path><path d="M642.4 752c-14.4-62.4-64-108.8-123.2-108.8S410.4 689.6 396 752h246.4z" fill="#FFFFFF"></path><path d="M519.2 611.2c-86.4 0-156.8 76.8-160 172.8h318.4c-1.6-96-72-172.8-158.4-172.8z m0 32c59.2 0 108.8 46.4 123.2 108.8H396c14.4-62.4 64-108.8 123.2-108.8z" fill=""></path></g></svg>

        <form method="get" class="flex gap-2 items-center">
          <input type="text" name="q" value="{{ q }}" placeholder="Buscar cedula, nombre o apellido" class="border rounded p-2" />
          <input type="date" name="start_date" value="{{ start_date }}" class="border rounded p-2" />
          <input type="date" name="end_date" value="{{ end_date }}" class="border rounded p-2" />
          <input type="number" name="min_score" value="{{ min_score }}" placeholder="Puntaje mínimo" min="1" max="5" class="border rounded p-2 w-32" />
          <button type="submit" class="px-3 py-2 bg-[#fff585] text-black rounded">Buscar</button>
          <a href="{% url 'reports_index' %}" class="px-3 py-2 bg-red-500 text-white rounded">Volver</a>
        </form>
      </div>

      {% if users and users.object_list %}
        <ul class="space-y-3">
          {% for u in users.object_list %}
            <li class="border p-3 rounded flex justify-between items-center">
              <div>
                <div class="font-semibold">{{ u.receiver_first_name }} {{ u.receiver_last_name }}</div>
                <div class="text-sm text-gray-600">Cédula: {{ u.receiver_cedula }}</div>
                <div class="text-sm text-gray-700">Promedio calificación receptor: {{ u.avg_receiver_rating|default:'-'|floatformat:1 }} · Reportes: {{ u.count_reports }}</div>
              </div>
              <div>
                <a href="{% url 'reports_user_detail' %}?receiver_cedula={{ u.receiver_cedula }}" class="px-3 py-2 bg-[#fff585] text-black rounded">Ver préstamos</a>
              </div>
            </li>
          {% endfor %}
        </ul>

        <div class="mt-4 flex justify-center">
          <nav class="inline-flex items-center">
            {% if users.has_previous %}
              <a href="?page={{ users.previous_page_number }}&q={{ q }}&start_date={{ start_date }}&end_date={{ end_date }}&min_score={{ min_score }}" class="px-3 py-1 border rounded-l">Anterior</a>
            {% else %}
              <span class="px-3 py-1 border rounded-l text-gray-400">Anterior</span>
            {% endif %}
            <span class="px-4 py-1 border-t border-b">Página {{ users.number }} de {{ users.paginator.num_pages }}</span>
            {% if users.has_next %}
              <a href="?page={{ users.next_page_number }}&q={{ q }}&start_date={{ start_date }}&end_date={{ end_date }}&min_score={{ min_score }}" class="px-3 py-1 border rounded-r">Siguiente</a>
            {% else %}
              <span class="px-3 py-1 border rounded-r text-gray-400">Siguiente</span>
            {% endif %}
          </nav>
        </div>
      {% else %}
        <div>No se encontraron usuarios con reportes o calificaciones.</div>
      {% endif %}
    </div>
  </div>
</main>
{% endblock %}