{% extends "base.html" %}
{% load static %}

{% block content %}

<main class="px-8 py-8" >
	<div class="container mx-auto max-w-6xl">
		<div class="bg-white shadow rounded-lg p-6">
			<div class="inline-flex items-center space-x-4 mb-8">
        <h1 class="text-2xl font-bold">Solicitudes de Prestamo</h1>
        <svg class="size-10 ml-6" fill="#66e8ea" viewBox="0 0 50 50" version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" overflow="inherit"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M25.154 17.347c3.953 0 7.144-3.217 7.144-7.183 0-3.958-3.19-7.164-7.144-7.164-3.948 0-7.153 3.207-7.153 7.164 0 3.965 3.206 7.183 7.153 7.183zm6.951 1.653c3.271 0 4.644 2.794 4.644 2.794l10.557 14.545c.437.649.694 1.443.694 2.3 0 2.26-1.828 4.097-4.081 4.097-.539 0-1.061-.117-1.519-.295l-6.4-1.774v6.333h-22v-6.333l-6.402 1.777c-.45.176-.968.296-1.509.296-2.251 0-4.088-1.83-4.088-4.09 0-.856.253-1.637.706-2.288l10.55-14.568s1.372-2.794 4.629-2.794h14.219zm-7.099 23.588l8.246-2.74-.179-.05c-5.705-1.672-3.518-9.228 2.173-7.537l.754.268v-8.521l-10.989 3.623-11.011-3.623v8.521l.754-.269c5.688-1.69 7.898 5.865 2.197 7.537l-.2.05 8.255 2.741z"></path></g></svg>
      </div>
			<p class="text-sm text-gray-600 mb-4">Aquí verás hasta 10 libros que has seleccionado para solicitar en préstamo.</p>

					{% if cart_books %}
						<div class="space-y-3">
							{% for book in cart_books %}
								<div class="flex items-center justify-between border p-3 rounded">
									<div class="flex items-center gap-4">
										{% if book.portada %}
											<img src="{{ book.portada.url }}" class="w-16 h-20 object-cover rounded" alt="{{ book.titulo }}">
										{% else %}
											<div class="w-16 h-20 bg-gray-100 rounded flex items-center justify-center text-sm text-gray-500">Sin portada</div>
										{% endif %}
															<div>
																<div class="font-semibold">
																	<a class="book-link" href="{% url 'task_detail' book.id %}"
																		 data-id="{{ book.id }}"
																		 data-title="{{ book.titulo|escape }}"
																		 data-author="{{ book.autor|default:''|escape }}"
																		 data-cota="{{ book.cota|default:''|escape }}"
																		 onclick="window.open(this.href,'bookDetail','width=720,height=680,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes'); return false;"
																		 style="color:#0366d6;text-decoration:none;">
																		{{ book.titulo }}
																	</a>
																</div>
																<div class="text-sm text-gray-600">Autor: {{ book.autor }}</div>
																<div class="text-sm text-gray-600">Cota: {{ book.cota }}</div>
																<div class="text-sm text-gray-600">Prestados: {{ book.prestados|default:0 }} / {{ book.total|default:0 }}</div>
															</div>
														</div>


									<div class="text-right">
										<div class="text-sm text-gray-700">Trabajador Encargado: <span class="font-medium">{{ loan_cart_user|default:request.user.get_full_name|default:request.user.username }}</span></div>
										<div class="mt-2">
											<form method="POST" action="{% url 'cart_remove' book.id %}" style="display:inline">
												{% csrf_token %}
												<button class="px-3 py-1 bg-red-500 text-white rounded text-sm">Quitar</button>
											</form>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>

						<div class="mt-6 border-t pt-4">
							<div class="mb-4 p-4 bg-gray-50 rounded-lg max-w-md border border-gray-200">
								<h3 class="text-sm font-bold text-gray-700 mb-2 uppercase tracking-wider">Datos de la Solicitud</h3>
								<div class="grid grid-cols-2 gap-y-1 text-sm">
									<span class="text-gray-500">Solicitante:</span>
									<span class="font-medium text-gray-900">{{ request.user.first_name }} {{ request.user.last_name }}</span>
									
									<span class="text-gray-500">Cédula:</span>
									<span class="font-medium text-gray-900">{{ request.user.cedula }}</span>
								</div>
								<p class="mt-3 text-xs text-gray-400 italic">* Estos datos se tomarán automáticamente de su perfil.</p>
							</div>
							<form method="POST" action="{% url 'cart_checkout' %}">
								{% csrf_token %}
								<button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded font-bold hover:bg-indigo-700 transition-colors">
									Confirmar solicitud de préstamo
								</button>
							</form>
						</div>
					{% else %}
						<div class="text-gray-600">No hay libros en el carrito.</div>
					{% endif %}

		</div>
	</div>
</main>

{% endblock %}